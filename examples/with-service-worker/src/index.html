<!DOCTYPE html>
<html>
  <head>
    <title>Graphyne Worker</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/gh/kognise/water.css@latest/dist/light.min.css"
    />
    <style>
      .code {
        display: inline-block;
        white-space: pre-wrap;
        text-align: left;
        padding: 1rem;
      }
    </style>
  </head>
  <body
    style="text-align: center; max-width: 860px; padding: 1rem; margin: 0 auto;"
  >
    <script src="./index.js"></script>
    <h1>Graphyne Worker example with Service Worker API</h1>
    <p>
      This example demonstrates a GraphQL execution <b>without a server</b> and
      instead right on the browser using
      <a href="https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API">Service Worker API</a>.
    </p>
    <div style="display: flex; flex-wrap: wrap;">
      <div style="flex: 1; padding: 0.5rem;">
        <h3>Code</h3>
        <h4>Using <a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API">Fetch API</a></h4>
        <code class="code">fetch('/graphql?query={hello}')</code>
        <div style="padding: .4rem;">
          <button id="queryFetch">Execute</button>
        </div>
        <h4>Using a GraphQL Client (<a href="https://github.com/FormidableLabs/urql">urql</a>)</h4>
        <code class="code">urqlClient.query('{ hello }').toPromise()</code>
        <div style="padding: .4rem;">
          <button id="queryUrql">Execute</button>
        </div>
      </div>
      <div style="flex: 1; padding: 0.5rem;">
        <h3>Result</h3>
        <textarea
          rows="8"
          cols="50"
          style="display: block; resize: none; margin: 1rem auto; padding: 2rem;"
          id="result"
        ></textarea>
        <p style="text-align: left; color: cornflowerblue;">Executed in ~<span id="result-ms"></span> ms</p>
      </div>
    </div>
    <h2>How it works?</h2>
    <p>
      After registering <code>worker.js</code> as a service worker, it will
      intercept all <code>fetch</code> events:
    </p>
    <div style="padding: 1rem;">
      <code class="code">addEventListener('fetch', (event) => {
  const url = new URL(event.request.url);
  if (url.pathname === '/graphql')
    return event.respondWith(
      handleRequest(graphyne, event.request, options)
    );
});</code>
    </div>
    <p>
      For requests to <a href="/graphql">/graphql</a>, we
      <code>responseWith</code> the (promise) result from
      <code
        ><a
          href="https://github.com/hoangvvo/graphyne/tree/master/packages/graphyne-worker"
          >graphyne-worker</a
        ></code
      >'s <code>handleRequest()</code>
      , while those to others will pass through.
    </p>
    <p>
      If you open the developer tool and look at the Network tab, you will see
      that those requests to <a href="/graphql">/graphql</a> will have
      <br />
      <code>status code 200 <b>(from ServiceWorker)</b></code>
    </p>
  </body>
</html>
