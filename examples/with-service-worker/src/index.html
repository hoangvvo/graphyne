<!DOCTYPE html>
<html>
  <head>
    <title>Graphyne Worker</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/gh/kognise/water.css@latest/dist/light.min.css"
    />  
    <style>
      .CodeMirror {
        border-radius: 6px;
        height: auto!important;
      }
      #result .CodeMirror {
        height: 300px!important;
      }
    </style>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.55.0/codemirror.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.55.0/theme/base16-light.min.css"
    />
  </head>
  <body
    style="max-width: 860px; padding: 1rem; margin: 0 auto;"
  >
    <script src="./index.js"></script>
    <div style="text-align: center;">
      <h1>Graphyne Worker example with Service Worker API</h1>
      <div>
        <a href="https://github.com/hoangvvo/graphyne/tree/master/examples/with-service-worker">GitHub</a>
      </div>
      <p>
        This example demonstrates a GraphQL execution <b>without a server</b> and
        instead right on the browser using
        <a href="https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API">Service Worker API</a>.
      </p>
    </div>
    <div style="display: flex;">
      <div style="flex: 1; padding: 0.5rem; overflow: hidden;">
        <div id="input">
          <h4>Query</h4>
          <div id="query"></div>
          <h4>Variables</h4>
          <div id="variables"></div>
        </div>

        <h4>Using <a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API">Fetch API</a></h4>
        <div id="codeFetch"></div>
        <div style="padding: .4rem;">
          <button id="queryFetch">Execute</button>
        </div>

        <h4>Using a GraphQL Client (<a href="https://github.com/FormidableLabs/urql">urql</a>)</h4>
        <div id="codeUrql"></div>
        <div style="padding: .4rem;">
          <button id="queryUrql">Execute</button>
        </div>
        
        <h4>Using Graphyne#graphql</h4>
        <div id="codeMessage"></div>
      
        <div style="padding: .4rem;">
          <button id="queryMessage">Execute</button>
        </div>
      </div>
      <div style="flex: 1; padding: 0.5rem; overflow: hidden;">
        <div style="position: sticky; top: 0;">
          <h3>Result</h3>
          <div id="result"></div>
          <p style="color: cornflowerblue;">Executed in ~<span id="result-ms"></span> ms</p>
        </div>
      </div>
    </div>
    <h2 style="text-align: center;">How does it works?</h2>
    <p style="text-align: center;">
      After registering <code>worker.js</code> as a service worker, it will
      intercept all <code>fetch</code> events:
    </p>
    <textarea id="codeHowWork">const graphyne = new Graphyne({ schema });
        
addEventListener('fetch', (event) => {
  const url = new URL(event.request.url);
  if (url.pathname === '/graphql')
    return event.respondWith(
      handleRequest(graphyne, event.request, options)
    );
});</textarea>
    <p>
      For requests to <a href="/graphql">/graphql</a>, we
      <code>responseWith</code> the (promise) result from
      <code
        ><a
          href="https://github.com/hoangvvo/graphyne/tree/master/packages/graphyne-worker"
          >graphyne-worker</a
        ></code
      >'s <code>handleRequest()</code>
      , while those to others will pass through.
    </p>
    <p>
      If you open the developer tool and look at the Network tab, you will see
      that requests to <a href="/graphql">/graphql</a> will have
      <br />
      <code>status code 200 <b>(from ServiceWorker)</b></code>
    </p>
  </body>
</html>
